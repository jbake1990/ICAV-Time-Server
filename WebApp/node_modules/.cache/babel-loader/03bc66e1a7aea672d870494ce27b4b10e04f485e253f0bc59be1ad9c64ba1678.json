{"ast":null,"code":"// Use relative URLs in production (Vercel) and allow override in development\nconst API_BASE_URL=process.env.REACT_APP_API_URL||(process.env.NODE_ENV==='production'?'':'http://localhost:3000');// Authentication helper functions\nconst getAuthToken=()=>{return localStorage.getItem('authToken');};export const setAuthToken=token=>{localStorage.setItem('authToken',token);};export const removeAuthToken=()=>{localStorage.removeItem('authToken');};const getAuthHeaders=()=>{const token=getAuthToken();return token?{'Authorization':`Bearer ${token}`}:{};};export const api={// Authentication\nasync login(username,password){const url=`${API_BASE_URL}/api/auth`;console.log('Making login request to:',url);console.log('Login credentials:',{username,hasPassword:!!password});const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'login',username,password})});console.log('Login response status:',response.status);console.log('Login response headers:',response.headers);if(!response.ok){const errorData=await response.json().catch(()=>({error:'Login failed'}));console.error('Login failed with error:',errorData);throw new Error(errorData.error||'Login failed');}const responseData=await response.json();console.log('Login successful, response data:',responseData);return responseData;},async logout(){const token=getAuthToken();if(token){const url=`${API_BASE_URL}/api/auth`;await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'logout',sessionToken:token})});}removeAuthToken();},async verifySession(){const token=getAuthToken();if(!token){throw new Error('No session token');}const url=`${API_BASE_URL}/api/auth`;const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'verify',sessionToken:token})});if(!response.ok){throw new Error('Session verification failed');}return response.json();},// Time Entries\nasync getTimeEntries(){const url=`${API_BASE_URL}/api/time-entries`;console.log('Fetching time entries from:',url);// Debug log\nconst response=await fetch(url,{headers:{...getAuthHeaders()}});if(!response.ok){console.error('API response not ok:',response.status,response.statusText);throw new Error(`Failed to fetch time entries: ${response.status} ${response.statusText}`);}return response.json();},async createTimeEntry(data){const url=`${API_BASE_URL}/api/time-entries`;const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(data)});if(!response.ok){throw new Error(`Failed to create time entry: ${response.status} ${response.statusText}`);}return response.json();},// Users\nasync getUsers(){const url=`${API_BASE_URL}/api/users`;const response=await fetch(url,{headers:{...getAuthHeaders()}});if(!response.ok){throw new Error(`Failed to fetch users: ${response.status} ${response.statusText}`);}return response.json();},async createUser(data){const url=`${API_BASE_URL}/api/users`;const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(data)});if(!response.ok){throw new Error(`Failed to create user: ${response.status} ${response.statusText}`);}return response.json();},async deleteUser(userId){const url=`${API_BASE_URL}/api/users?userId=${encodeURIComponent(userId)}`;const response=await fetch(url,{method:'DELETE',headers:{...getAuthHeaders()}});if(!response.ok){const errorData=await response.json().catch(()=>({error:'Unknown error'}));throw new Error(errorData.error||`Failed to delete user: ${response.status} ${response.statusText}`);}return response.json();},// Admin functions\nasync clearDatabase(){const url=`${API_BASE_URL}/api/admin?action=reset-db`;const response=await fetch(url,{method:'POST',headers:{...getAuthHeaders()}});if(!response.ok){const errorData=await response.json().catch(()=>({error:'Unknown error'}));throw new Error(errorData.error||`Failed to clear database: ${response.status} ${response.statusText}`);}return response.json();}};","map":{"version":3,"names":["API_BASE_URL","process","env","REACT_APP_API_URL","NODE_ENV","getAuthToken","localStorage","getItem","setAuthToken","token","setItem","removeAuthToken","removeItem","getAuthHeaders","api","login","username","password","url","console","log","hasPassword","response","fetch","method","headers","body","JSON","stringify","action","status","ok","errorData","json","catch","error","Error","responseData","logout","sessionToken","verifySession","getTimeEntries","statusText","createTimeEntry","data","getUsers","createUser","deleteUser","userId","encodeURIComponent","clearDatabase"],"sources":["/Users/jasonbaker/Documents/ICAV Time Tracker/icav-time-dev/server/WebApp/src/services/api.ts"],"sourcesContent":["// Use relative URLs in production (Vercel) and allow override in development\nconst API_BASE_URL = process.env.REACT_APP_API_URL || (process.env.NODE_ENV === 'production' ? '' : 'http://localhost:3000');\n\n// Authentication helper functions\nconst getAuthToken = (): string | null => {\n  return localStorage.getItem('authToken');\n};\n\nexport const setAuthToken = (token: string): void => {\n  localStorage.setItem('authToken', token);\n};\n\nexport const removeAuthToken = (): void => {\n  localStorage.removeItem('authToken');\n};\n\nconst getAuthHeaders = (): Record<string, string> => {\n  const token = getAuthToken();\n  return token ? { 'Authorization': `Bearer ${token}` } : {};\n};\n\nexport interface ApiTimeEntry {\n  id: string;\n  userId: string;\n  technicianName: string;\n  customerName: string;\n  clockInTime: string;\n  clockOutTime?: string;\n  lunchStartTime?: string;\n  lunchEndTime?: string;\n  driveStartTime?: string;\n  driveEndTime?: string;\n  isActive: boolean;\n  isOnLunch: boolean;\n  isDriving: boolean;\n  duration?: number;\n  formattedDuration?: string;\n  lunchDuration?: number;\n  formattedLunchDuration?: string;\n  driveDuration?: number;\n  formattedDriveDuration?: string;\n}\n\nexport interface ApiUser {\n  id: string;\n  username: string;\n  displayName: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport const api = {\n  // Authentication\n  async login(username: string, password: string): Promise<{ user: any; token: string; expiresAt: string }> {\n    const url = `${API_BASE_URL}/api/auth`;\n    console.log('Making login request to:', url);\n    console.log('Login credentials:', { username, hasPassword: !!password });\n    \n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ action: 'login', username, password }),\n    });\n    \n    console.log('Login response status:', response.status);\n    console.log('Login response headers:', response.headers);\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({ error: 'Login failed' }));\n      console.error('Login failed with error:', errorData);\n      throw new Error(errorData.error || 'Login failed');\n    }\n    \n    const responseData = await response.json();\n    console.log('Login successful, response data:', responseData);\n    return responseData;\n  },\n\n  async logout(): Promise<void> {\n    const token = getAuthToken();\n    if (token) {\n      const url = `${API_BASE_URL}/api/auth`;\n      await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ action: 'logout', sessionToken: token }),\n      });\n    }\n    removeAuthToken();\n  },\n\n  async verifySession(): Promise<{ user: any; token: string; expiresAt: string }> {\n    const token = getAuthToken();\n    if (!token) {\n      throw new Error('No session token');\n    }\n    \n    const url = `${API_BASE_URL}/api/auth`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ action: 'verify', sessionToken: token }),\n    });\n    \n    if (!response.ok) {\n      throw new Error('Session verification failed');\n    }\n    return response.json();\n  },\n\n  // Time Entries\n  async getTimeEntries(): Promise<ApiTimeEntry[]> {\n    const url = `${API_BASE_URL}/api/time-entries`;\n    console.log('Fetching time entries from:', url); // Debug log\n    \n    const response = await fetch(url, {\n      headers: {\n        ...getAuthHeaders(),\n      },\n    });\n    if (!response.ok) {\n      console.error('API response not ok:', response.status, response.statusText);\n      throw new Error(`Failed to fetch time entries: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n\n  async createTimeEntry(data: {\n    userId: string;\n    technicianName: string;\n    customerName: string;\n    clockInTime: string;\n    clockOutTime?: string;\n    lunchStartTime?: string;\n    lunchEndTime?: string;\n    driveStartTime?: string;\n    driveEndTime?: string;\n  }): Promise<ApiTimeEntry> {\n    const url = `${API_BASE_URL}/api/time-entries`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeaders(),\n      },\n      body: JSON.stringify(data),\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to create time entry: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n\n  // Users\n  async getUsers(): Promise<ApiUser[]> {\n    const url = `${API_BASE_URL}/api/users`;\n    const response = await fetch(url, {\n      headers: {\n        ...getAuthHeaders(),\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to fetch users: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n\n  async createUser(data: { username: string; displayName: string; password?: string; role?: string }): Promise<ApiUser> {\n    const url = `${API_BASE_URL}/api/users`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeaders(),\n      },\n      body: JSON.stringify(data),\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to create user: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n\n  async deleteUser(userId: string): Promise<{ message: string; deletedUser: { id: string; username: string; displayName: string } }> {\n    const url = `${API_BASE_URL}/api/users?userId=${encodeURIComponent(userId)}`;\n    const response = await fetch(url, {\n      method: 'DELETE',\n      headers: {\n        ...getAuthHeaders(),\n      },\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n      throw new Error(errorData.error || `Failed to delete user: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n\n  // Admin functions\n  async clearDatabase(): Promise<{ success: boolean; message: string; deletedCount: number }> {\n    const url = `${API_BASE_URL}/api/admin?action=reset-db`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        ...getAuthHeaders(),\n      },\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n      throw new Error(errorData.error || `Failed to clear database: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  },\n}; "],"mappings":"AAAA;AACA,KAAM,CAAAA,YAAY,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,GAAKF,OAAO,CAACC,GAAG,CAACE,QAAQ,GAAK,YAAY,CAAG,EAAE,CAAG,uBAAuB,CAAC,CAE5H;AACA,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAqB,CACxC,MAAO,CAAAC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CAC1C,CAAC,CAED,MAAO,MAAM,CAAAC,YAAY,CAAIC,KAAa,EAAW,CACnDH,YAAY,CAACI,OAAO,CAAC,WAAW,CAAED,KAAK,CAAC,CAC1C,CAAC,CAED,MAAO,MAAM,CAAAE,eAAe,CAAGA,CAAA,GAAY,CACzCL,YAAY,CAACM,UAAU,CAAC,WAAW,CAAC,CACtC,CAAC,CAED,KAAM,CAAAC,cAAc,CAAGA,CAAA,GAA8B,CACnD,KAAM,CAAAJ,KAAK,CAAGJ,YAAY,CAAC,CAAC,CAC5B,MAAO,CAAAI,KAAK,CAAG,CAAE,eAAe,CAAE,UAAUA,KAAK,EAAG,CAAC,CAAG,CAAC,CAAC,CAC5D,CAAC,CAgCD,MAAO,MAAM,CAAAK,GAAG,CAAG,CACjB;AACA,KAAM,CAAAC,KAAKA,CAACC,QAAgB,CAAEC,QAAgB,CAA4D,CACxG,KAAM,CAAAC,GAAG,CAAG,GAAGlB,YAAY,WAAW,CACtCmB,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAEF,GAAG,CAAC,CAC5CC,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAE,CAAEJ,QAAQ,CAAEK,WAAW,CAAE,CAAC,CAACJ,QAAS,CAAC,CAAC,CAExE,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,MAAM,CAAE,OAAO,CAAEb,QAAQ,CAAEC,QAAS,CAAC,CAC9D,CAAC,CAAC,CAEFE,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEE,QAAQ,CAACQ,MAAM,CAAC,CACtDX,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAEE,QAAQ,CAACG,OAAO,CAAC,CAExD,GAAI,CAACH,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAV,QAAQ,CAACW,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,KAAO,CAAEC,KAAK,CAAE,cAAe,CAAC,CAAC,CAAC,CAChFhB,OAAO,CAACgB,KAAK,CAAC,0BAA0B,CAAEH,SAAS,CAAC,CACpD,KAAM,IAAI,CAAAI,KAAK,CAACJ,SAAS,CAACG,KAAK,EAAI,cAAc,CAAC,CACpD,CAEA,KAAM,CAAAE,YAAY,CAAG,KAAM,CAAAf,QAAQ,CAACW,IAAI,CAAC,CAAC,CAC1Cd,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAEiB,YAAY,CAAC,CAC7D,MAAO,CAAAA,YAAY,CACrB,CAAC,CAED,KAAM,CAAAC,MAAMA,CAAA,CAAkB,CAC5B,KAAM,CAAA7B,KAAK,CAAGJ,YAAY,CAAC,CAAC,CAC5B,GAAII,KAAK,CAAE,CACT,KAAM,CAAAS,GAAG,CAAG,GAAGlB,YAAY,WAAW,CACtC,KAAM,CAAAuB,KAAK,CAACL,GAAG,CAAE,CACfM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,MAAM,CAAE,QAAQ,CAAEU,YAAY,CAAE9B,KAAM,CAAC,CAChE,CAAC,CAAC,CACJ,CACAE,eAAe,CAAC,CAAC,CACnB,CAAC,CAED,KAAM,CAAA6B,aAAaA,CAAA,CAA6D,CAC9E,KAAM,CAAA/B,KAAK,CAAGJ,YAAY,CAAC,CAAC,CAC5B,GAAI,CAACI,KAAK,CAAE,CACV,KAAM,IAAI,CAAA2B,KAAK,CAAC,kBAAkB,CAAC,CACrC,CAEA,KAAM,CAAAlB,GAAG,CAAG,GAAGlB,YAAY,WAAW,CACtC,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,MAAM,CAAE,QAAQ,CAAEU,YAAY,CAAE9B,KAAM,CAAC,CAChE,CAAC,CAAC,CAEF,GAAI,CAACa,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAK,KAAK,CAAC,6BAA6B,CAAC,CAChD,CACA,MAAO,CAAAd,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED;AACA,KAAM,CAAAQ,cAAcA,CAAA,CAA4B,CAC9C,KAAM,CAAAvB,GAAG,CAAG,GAAGlB,YAAY,mBAAmB,CAC9CmB,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAEF,GAAG,CAAC,CAAE;AAEjD,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCO,OAAO,CAAE,CACP,GAAGZ,cAAc,CAAC,CACpB,CACF,CAAC,CAAC,CACF,GAAI,CAACS,QAAQ,CAACS,EAAE,CAAE,CAChBZ,OAAO,CAACgB,KAAK,CAAC,sBAAsB,CAAEb,QAAQ,CAACQ,MAAM,CAAER,QAAQ,CAACoB,UAAU,CAAC,CAC3E,KAAM,IAAI,CAAAN,KAAK,CAAC,iCAAiCd,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CAC5F,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED,KAAM,CAAAU,eAAeA,CAACC,IAUrB,CAAyB,CACxB,KAAM,CAAA1B,GAAG,CAAG,GAAGlB,YAAY,mBAAmB,CAC9C,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,GAAGZ,cAAc,CAAC,CACpB,CAAC,CACDa,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACgB,IAAI,CAC3B,CAAC,CAAC,CACF,GAAI,CAACtB,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAK,KAAK,CAAC,gCAAgCd,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CAC3F,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED;AACA,KAAM,CAAAY,QAAQA,CAAA,CAAuB,CACnC,KAAM,CAAA3B,GAAG,CAAG,GAAGlB,YAAY,YAAY,CACvC,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCO,OAAO,CAAE,CACP,GAAGZ,cAAc,CAAC,CACpB,CACF,CAAC,CAAC,CACF,GAAI,CAACS,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAK,KAAK,CAAC,0BAA0Bd,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CACrF,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED,KAAM,CAAAa,UAAUA,CAACF,IAAiF,CAAoB,CACpH,KAAM,CAAA1B,GAAG,CAAG,GAAGlB,YAAY,YAAY,CACvC,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,GAAGZ,cAAc,CAAC,CACpB,CAAC,CACDa,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACgB,IAAI,CAC3B,CAAC,CAAC,CACF,GAAI,CAACtB,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAK,KAAK,CAAC,0BAA0Bd,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CACrF,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED,KAAM,CAAAc,UAAUA,CAACC,MAAc,CAAoG,CACjI,KAAM,CAAA9B,GAAG,CAAG,GAAGlB,YAAY,qBAAqBiD,kBAAkB,CAACD,MAAM,CAAC,EAAE,CAC5E,KAAM,CAAA1B,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,QAAQ,CAChBC,OAAO,CAAE,CACP,GAAGZ,cAAc,CAAC,CACpB,CACF,CAAC,CAAC,CACF,GAAI,CAACS,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAV,QAAQ,CAACW,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,KAAO,CAAEC,KAAK,CAAE,eAAgB,CAAC,CAAC,CAAC,CACjF,KAAM,IAAI,CAAAC,KAAK,CAACJ,SAAS,CAACG,KAAK,EAAI,0BAA0Bb,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CACxG,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CAAC,CAED;AACA,KAAM,CAAAiB,aAAaA,CAAA,CAAyE,CAC1F,KAAM,CAAAhC,GAAG,CAAG,GAAGlB,YAAY,4BAA4B,CACvD,KAAM,CAAAsB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACL,GAAG,CAAE,CAChCM,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,GAAGZ,cAAc,CAAC,CACpB,CACF,CAAC,CAAC,CACF,GAAI,CAACS,QAAQ,CAACS,EAAE,CAAE,CAChB,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAAV,QAAQ,CAACW,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,KAAO,CAAEC,KAAK,CAAE,eAAgB,CAAC,CAAC,CAAC,CACjF,KAAM,IAAI,CAAAC,KAAK,CAACJ,SAAS,CAACG,KAAK,EAAI,6BAA6Bb,QAAQ,CAACQ,MAAM,IAAIR,QAAQ,CAACoB,UAAU,EAAE,CAAC,CAC3G,CACA,MAAO,CAAApB,QAAQ,CAACW,IAAI,CAAC,CAAC,CACxB,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}